# MVVM

### 목차

- MVC
- MVP
- MVVM
- AAC?



### MVC

안드로이드 앱 개발을 초기에 할 때 Activity클래스에 모든 앱 동작 코드를 다 집어 넣는 경우가 많다. 체계적이 없다면 추후에 유지보수 뿐 아니라 단점들이 많이 발생한다.

- 앱 동작이 많아질 수록 Activity자체가 무거워짐
- View와 Model간의 의존성이 높아져 코드가 복잡해짐
- View의 UI Refresh를 위해 Model을 참조하므로 앱 규모가 커질수록 코드가 복잡해 짐

즉 유지보수가 어렵고 규모가 커질수록 액티비티에 부담을 크게 준다는 것이다.

MVC 패턴의 구조는 다음과 같다.

1. Controller 가 사용자 동작을 받아들임 (텍스트 입력, 버튼 터치 등)
2. Controller 가 사용자의 동작에 따른 Model 업데이트를 요청
3. Controller 가 Model 을 나타낼 View 를 선택
4. View 는 Model 을 참조하여 UI 를 업데이트

View와 Model간 의존성이 높아질 수 밖에 없고 Controller가 View,Model사이에서 바쁘게 움직이기 때문에 Controller는 무거워지고 코드 유지보수를 하다가 위험에 빠질 가능성이 크다. -> 구현 쉬움, 유지보수 어려움

----

### MVP

MVP패턴은 Model, View, Presenter의 약자이며 핵심 설계는 MVC와는 다르게 UI와 비즈니스 로직을 분리하고, 서로간의 상호작용을 다른 객체에 역할을 줌으로써 서로의 의존성을 최소화한다.

#### Model

- 프로그램 내부적으로 쓰이는 데이터를 저장하고 처리를한다. View,Presenter와 다른 독립적인 영역이다.

#### View

- UI를 담당하며 Model에서 처리된 데이터를 Presenter를 통해 받아 유저에게 보여준다.
- 유저의 액션이나, 액티비티 생명주기 상태 변경을 주시하며 Presenter에 보내는 역할
- Presenter를 이용하여 데이터를 주고 받기 때문에 Presenter에 의존적이다.

#### Presenter

- Controller와 유사하지만 View에 직접 연결되는 대신 인터페이스를 통해 상호작용하는 점이 다르다.
- 뷰에게 표시할 내용만 전달하며 어떻게 보여줄지는 View가 담당한다.

### 장점

MVP를 이용해서 이와 같이 Model과 View 간의 결합도를 낮추면, 새로운 기능 추가 및 변경을 해야 할 때 관련된 해당 부분만 코드 수정하면 되기 때문에 확장성이 좋아짐과 동시에 유닛 테스트 시 테스트 코드를 작성하기 편리해지기 때문에 더 쉽게 안전한 코딩이 가능하다.
그리고 UI, Data 각각 파트를 나누기 때문에 해야 할 일이 명확해지고 그 결과로 쉽고 빠르게 코딩이 가능하다.

### 단점

앱이 무거워질수록 View와 Presenter의 의존성이 강해져 Controller처럼 비즈니스 로직이 집중되는 경향이 있다. 즉, 앱의 사이즈가 크면 클수록 MVC패턴의 문제와 동일한 문제점이 생긴다.

---

### MVVM

mvc패턴의 단점을 보완하고자 나온 디자인 패턴이며 Controller에게만 의존하는 것이 아닌 해당 동작을 분리해서 체계적으로 만들고 유지보수를 편리하게 하는 디자인 패턴이다. MVVM은 Model, View, ViewModel 로 이루어진다.

### View

1. Activity/Fragment가 view 역할을 한다.
2. 사용자의 Action을 받는다.
3. ViewModel의 데이터를 관찰하여 UI 갱신 -> 중요

### ViewModel

1. View가 요청한 데이터를 Model로 요청한다.
2. Model로부터 요청한 데이터를 받는다.

### Model

1. ViewModel이 요청한 데이터를 반환한다.
2. Room, Realm과 같은 DB사용이나, Retrofit을 통한 백엔드 API호출이 보편적이다.

### 장점

1. View가 ViewModel의 데이터를 관찰하고 있어 UI업데이트가 간편하다
2. ViewModel이 데이터를 홀드하고 있어 메모리 누수 발생 가능성을 배제한다.
3. 기능별 모듈화가 잘 되어 유지 보수에 용이하다.
4. 구글에서 AAC라는 것을 제공하여 MVVM패턴을 간편하게 적용해볼 수 있게끔 제공해준다.

### 단점

1. 구조가 복잡하여 진입장벽이 높다.
2. MVVM패턴을 쓰면 도중에 다른 패턴으로 변경이 불가하다.

### AAC (Android Architecture Component)

#### ViewModel

- 화면 변화 시에도 변하지 않는(사라지지 않는) 데이터를 가지고 있다.

#### LiveData

- View가 ViewModel을 관찰할 때 , 그 관찰 대상이 되는 데이터 홀더 클래스이다. LiveData는 Activity, Fragment의 생명주기를 인지하지 못하므로, 화면이 활성화 되어 있을 때만 동작하여 메모리 릭을 줄여준다.

#### Repository

- ViewModel과 데이터를 주고받기 위해, 데이터 API를 포함하는 클래스. 사용자의 동작에 따라 필요한 데이터나 외부 백엔드 서버 등에서 데이터를 가져옴. Repository의 존재 덕분에 ViewModel이 데이터를 관리할 필요가 없게 된다.

#### Room

- Room은 SQLite를 사용함에 있어 쿼리문을 작성없이 간편하게 동작을 할 수 있게끔 도와주는 ORM라이브러리

